ANDESCODE - DOCUMENTACIÃ“N TÃ‰CNICA
ğŸ”’ DOCUMENTO INTERNO - CONFIDENCIAL

ImplementaciÃ³n CatÃ¡logo de Productos
GalerÃ­a de Arquitectura e Interiorismo



ğŸ“‹ Contenido del Documento:
1. Resumen Ejecutivo del Proyecto
2. Contexto y Estado Actual
3. Arquitectura TÃ©cnica Completa
4. Stack TecnolÃ³gico Detallado
5. Estructura del Proyecto
6. Modelo de Datos (Base de Datos)
7. API REST - Endpoints
8. Frontend Admin Panel
9. Frontend PÃºblico (CatÃ¡logo)
10. AutenticaciÃ³n y Seguridad
11. IntegraciÃ³n con Cloudinary
12. Deploy y DevOps
13. Testing y QA
14. Cronograma Detallado
15. Consideraciones para E-commerce Futuro


1. RESUMEN EJECUTIVO DEL PROYECTO
Cliente requiere ampliar su sitio web estÃ¡tico (actualmente en Astro) con un catÃ¡logo de productos dinÃ¡mico que incluya panel de administraciÃ³n para gestiÃ³n completa de productos sin necesidad de editar cÃ³digo.

Puntos Clave:
â€¢ Sitio actual: Astro estÃ¡tico en Vercel/Netlify
â€¢ Nueva funcionalidad: CatÃ¡logo dinÃ¡mico + Admin Panel
â€¢ Backend: NestJS + PostgreSQL (Supabase)
â€¢ ImÃ¡genes: Cloudinary
â€¢ Timeline: 4 semanas
â€¢ Presupuesto cliente: $250 USD
â€¢ Arquitectura pensada para escalar a e-commerce

2. CONTEXTO Y ESTADO ACTUAL
2.1 Estado Actual del Sitio
El cliente ya tiene un sitio web portfolio/galerÃ­a desarrollado por AndesCode con las siguientes caracterÃ­sticas:
âœ“ Framework: Astro (sitio estÃ¡tico)
âœ“ Hosting: Vercel o Netlify (plan gratuito)
âœ“ Secciones: Home, Proyectos, Estudio, Contacto
âœ“ DiseÃ±o: Minimalista, inspirado en Lotta Agaton, Norm Architects
âœ“ Responsive: Mobile, tablet, desktop
âœ“ Sin CMS: Contenido se actualiza mediante cÃ³digo

2.2 LimitaciÃ³n Actual
La secciÃ³n "Productos/CatÃ¡logo" fue propuesta en fase 1 pero no implementada. Cliente necesita mostrar productos (muebles, decoraciÃ³n) con informaciÃ³n detallada y poder actualizarlos sin contactar al desarrollador.

3. ARQUITECTURA TÃ‰CNICA COMPLETA

3.1 Diagrama de Arquitectura
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USUARIOS PÃšBLICOS                         â”‚
â”‚                    (Visitantes web)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              FRONTEND PÃšBLICO (Astro SSR)                    â”‚
â”‚              Hosting: Vercel/Netlify                         â”‚
â”‚                                                              â”‚
â”‚  Rutas:                                                      â”‚
â”‚  â€¢ /                    (Home)                               â”‚
â”‚  â€¢ /proyectos           (GalerÃ­a proyectos)                  â”‚
â”‚  â€¢ /productos           (CatÃ¡logo)                           â”‚
â”‚  â€¢ /productos/[slug]    (Detalle producto)                   â”‚
â”‚  â€¢ /estudio             (Info studio)                        â”‚
â”‚  â€¢ /contacto            (Contacto)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ HTTP/REST
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚              PANEL DE ADMINISTRACIÃ“N                         â”‚
â”‚              (Astro + React Islands)                         â”‚
â”‚              Hosting: Mismo Vercel/Netlify                   â”‚
â”‚                                                              â”‚
â”‚  Rutas Privadas (ğŸ”’ JWT):                                   â”‚
â”‚  â€¢ /admin/login         (Login)                              â”‚
â”‚  â€¢ /admin               (Dashboard)                          â”‚
â”‚  â€¢ /admin/productos     (Lista)                              â”‚
â”‚  â€¢ /admin/productos/nuevo                                    â”‚
â”‚  â€¢ /admin/productos/[id]/editar                              â”‚
â”‚  â€¢ /admin/categorias    (GestiÃ³n categorÃ­as)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ HTTPS + JWT
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BACKEND API REST (NestJS)                       â”‚
â”‚              Hosting: VPS AndesCode                          â”‚
â”‚              Puerto: 3000 o custom                           â”‚
â”‚              Dominio: api.cliente.com                        â”‚
â”‚                                                              â”‚
â”‚  MÃ³dulos:                                                    â”‚
â”‚  â€¢ AuthModule          (Login, JWT)                          â”‚
â”‚  â€¢ ProductsModule      (CRUD productos)                      â”‚
â”‚  â€¢ CategoriesModule    (CRUD categorÃ­as)                     â”‚
â”‚  â€¢ UploadsModule       (Cloudinary)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                       â”‚
             â”‚                       â”‚
             â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   SUPABASE     â”‚    â”‚    CLOUDINARY       â”‚
    â”‚   PostgreSQL   â”‚    â”‚    (CDN ImÃ¡genes)   â”‚
    â”‚                â”‚    â”‚                     â”‚
    â”‚   Free Tier    â”‚    â”‚    Free Tier        â”‚
    â”‚   500MB DB     â”‚    â”‚    25GB Storage     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3.2 DecisiÃ³n ArquitectÃ³nica Clave: Admin en Astro
IMPORTANTE: En lugar de crear un proyecto React separado para el admin, usaremos Astro con React Islands. Esto significa:
âœ“ Todo en un solo proyecto Astro
âœ“ Admin panel en /admin/* (rutas protegidas)
âœ“ Componentes React solo donde se necesite interactividad (formularios, tablas)
âœ“ Un solo deploy en Vercel/Netlify
âœ“ No necesitamos hosting adicional para el admin
âœ“ SSR habilitado para manejar autenticaciÃ³n en server-side

4. STACK TECNOLÃ“GICO DETALLADO
4.1 Frontend PÃºblico
TecnologÃ­a
VersiÃ³n
PropÃ³sito
Astro
4.x
Framework principal, SSR
React
18.x
Componentes interactivos (islands)
TypeScript
5.x
Type safety
TailwindCSS
3.x
Estilos
React Query
5.x
Data fetching y cachÃ©
Zod
latest
ValidaciÃ³n de datos


4.2 Backend API
TecnologÃ­a
VersiÃ³n
PropÃ³sito
Node.js
20.x LTS
Runtime
NestJS
10.x
Framework backend
TypeScript
5.x
Lenguaje
Prisma ORM
5.x
Database ORM
PostgreSQL
15.x
Base de datos (Supabase)
Passport.js
latest
AutenticaciÃ³n
JWT
latest
Tokens
class-validator
latest
ValidaciÃ³n DTOs


4.3 Infraestructura y Servicios
Servicio
ConfiguraciÃ³n
Hosting Frontend
Vercel/Netlify (plan free)
Hosting Backend
VPS AndesCode
Base de Datos
Supabase PostgreSQL (free tier 500MB)
ImÃ¡genes
Cloudinary (free tier 25GB)


5. ESTRUCTURA DEL PROYECTO
5.1 Estructura Frontend (Astro)
proyecto-galeria/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ public/                 # Componentes pÃºblicos
â”‚   â”‚   â”‚   â”œâ”€â”€ ProductCard.astro
â”‚   â”‚   â”‚   â”œâ”€â”€ ProductGrid.astro
â”‚   â”‚   â”‚   â”œâ”€â”€ CategoryFilter.astro
â”‚   â”‚   â”‚   â””â”€â”€ ProductGallery.astro
â”‚   â”‚   â””â”€â”€ admin/                  # Componentes admin (React)
â”‚   â”‚       â”œâ”€â”€ ProductForm.tsx     # Formulario productos
â”‚   â”‚       â”œâ”€â”€ ProductList.tsx     # Lista con filtros
â”‚   â”‚       â”œâ”€â”€ ImageUploader.tsx   # Upload imÃ¡genes
â”‚   â”‚       â”œâ”€â”€ Dashboard.tsx       # Dashboard stats
â”‚   â”‚       â””â”€â”€ CategoryManager.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ layouts/
â”‚   â”‚   â”œâ”€â”€ BaseLayout.astro        # Layout pÃºblico
â”‚   â”‚   â””â”€â”€ AdminLayout.astro       # Layout admin
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ index.astro             # Home
â”‚   â”‚   â”œâ”€â”€ proyectos/
â”‚   â”‚   â”‚   â””â”€â”€ [slug].astro
â”‚   â”‚   â”œâ”€â”€ productos/              # ğŸ›ï¸ NUEVO
â”‚   â”‚   â”‚   â”œâ”€â”€ index.astro         # CatÃ¡logo
â”‚   â”‚   â”‚   â””â”€â”€ [slug].astro        # Detalle producto
â”‚   â”‚   â”œâ”€â”€ estudio.astro
â”‚   â”‚   â”œâ”€â”€ contacto.astro
â”‚   â”‚   â””â”€â”€ admin/                  # ğŸ”’ ADMIN PANEL
â”‚   â”‚       â”œâ”€â”€ login.astro
â”‚   â”‚       â”œâ”€â”€ index.astro         # Dashboard
â”‚   â”‚       â”œâ”€â”€ productos/
â”‚   â”‚       â”‚   â”œâ”€â”€ index.astro     # Lista productos
â”‚   â”‚       â”‚   â”œâ”€â”€ nuevo.astro     # Crear producto
â”‚   â”‚       â”‚   â””â”€â”€ [id]/
â”‚   â”‚       â”‚       â””â”€â”€ editar.astro
â”‚   â”‚       â””â”€â”€ categorias/
â”‚   â”‚           â””â”€â”€ index.astro
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ api.ts                  # Cliente API REST
â”‚   â”‚   â”œâ”€â”€ auth.ts                 # Helpers autenticaciÃ³n
â”‚   â”‚   â””â”€â”€ utils.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ index.ts                # Types TypeScript
â”‚   â”‚
â”‚   â””â”€â”€ styles/
â”‚       â””â”€â”€ global.css
â”‚
â”œâ”€â”€ public/
â”‚   â””â”€â”€ assets/
â”‚
â”œâ”€â”€ astro.config.mjs
â”œâ”€â”€ tailwind.config.mjs
â”œâ”€â”€ tsconfig.json
â””â”€â”€ package.json

5.2 Estructura Backend (NestJS)
backend-api/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”œâ”€â”€ auth.module.ts
â”‚   â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”‚   â”œâ”€â”€ login.dto.ts
â”‚   â”‚   â”‚   â””â”€â”€ register.dto.ts
â”‚   â”‚   â”œâ”€â”€ guards/
â”‚   â”‚   â”‚   â””â”€â”€ jwt-auth.guard.ts
â”‚   â”‚   â””â”€â”€ strategies/
â”‚   â”‚       â””â”€â”€ jwt.strategy.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ products/
â”‚   â”‚   â”œâ”€â”€ products.controller.ts
â”‚   â”‚   â”œâ”€â”€ products.service.ts
â”‚   â”‚   â”œâ”€â”€ products.module.ts
â”‚   â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”‚   â”œâ”€â”€ create-product.dto.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ update-product.dto.ts
â”‚   â”‚   â”‚   â””â”€â”€ query-product.dto.ts
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”‚       â””â”€â”€ product.entity.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ categories/
â”‚   â”‚   â”œâ”€â”€ categories.controller.ts
â”‚   â”‚   â”œâ”€â”€ categories.service.ts
â”‚   â”‚   â”œâ”€â”€ categories.module.ts
â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”‚       â””â”€â”€ create-category.dto.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ uploads/
â”‚   â”‚   â”œâ”€â”€ uploads.controller.ts
â”‚   â”‚   â”œâ”€â”€ uploads.service.ts
â”‚   â”‚   â”œâ”€â”€ uploads.module.ts
â”‚   â”‚   â””â”€â”€ cloudinary.config.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â”œâ”€â”€ prisma.service.ts
â”‚   â”‚   â””â”€â”€ prisma.module.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â”œâ”€â”€ filters/
â”‚   â”‚   â”‚   â””â”€â”€ http-exception.filter.ts
â”‚   â”‚   â”œâ”€â”€ interceptors/
â”‚   â”‚   â”‚   â””â”€â”€ transform.interceptor.ts
â”‚   â”‚   â””â”€â”€ decorators/
â”‚   â”‚       â””â”€â”€ current-user.decorator.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ app.module.ts
â”‚   â””â”€â”€ main.ts
â”‚
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma
â”‚   â””â”€â”€ migrations/
â”‚
â”œâ”€â”€ test/
â”œâ”€â”€ .env
â”œâ”€â”€ .env.example
â”œâ”€â”€ nest-cli.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ package.json

6. MODELO DE DATOS (BASE DE DATOS)
6.1 Schema Prisma (prisma/schema.prisma)
// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String   // bcrypt hash
  name      String
  role      Role     @default(ADMIN)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("users")
}

enum Role {
  ADMIN
  EDITOR
}

model Category {
  id          String    @id @default(uuid())
  name        String    @unique
  slug        String    @unique
  description String?
  products    Product[]
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  @@map("categories")
}

model Product {
  id              String         @id @default(uuid())
  name            String
  slug            String         @unique
  description     String?        @db.Text
  price           Decimal        @db.Decimal(10, 2)
  specifications  Json?          // JSON flexible para specs
  status          ProductStatus  @default(DRAFT)
  categoryId      String         @map("category_id")
  category        Category       @relation(fields: [categoryId], references: [id])
  images          ProductImage[]
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")
  deletedAt       DateTime?      @map("deleted_at") // Soft delete

  @@index([categoryId])
  @@index([status])
  @@index([slug])
  @@map("products")
}

enum ProductStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

model ProductImage {
  id                String   @id @default(uuid())
  productId         String   @map("product_id")
  product           Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  cloudinaryUrl     String   @map("cloudinary_url")
  cloudinaryPublicId String  @map("cloudinary_public_id")
  altText           String?  @map("alt_text")
  isPrimary         Boolean  @default(false) @map("is_primary")
  order             Int      @default(0)
  createdAt         DateTime @default(now()) @map("created_at")

  @@index([productId])
  @@map("product_images")
}

6.2 Diagrama Entidad-RelaciÃ³n
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     User        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚
â”‚ email (unique)  â”‚
â”‚ password        â”‚
â”‚ name            â”‚
â”‚ role            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Category      â”‚              â”‚    Product      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ id (PK)         â”‚
â”‚ name (unique)   â”‚     1:N      â”‚ name            â”‚
â”‚ slug (unique)   â”‚              â”‚ slug (unique)   â”‚
â”‚ description     â”‚              â”‚ description     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ price           â”‚
                                 â”‚ specifications  â”‚
                                 â”‚ status          â”‚
                                 â”‚ categoryId (FK) â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â”‚ 1:N
                                          â”‚
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚ ProductImage    â”‚
                                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                 â”‚ id (PK)         â”‚
                                 â”‚ productId (FK)  â”‚
                                 â”‚ cloudinaryUrl   â”‚
                                 â”‚ cloudinaryPublicIdâ”‚
                                 â”‚ altText         â”‚
                                 â”‚ isPrimary       â”‚
                                 â”‚ order           â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

7. API REST - ENDPOINTS
Base URL: https://api.cliente.com (o subdominio configurado)

7.1 AutenticaciÃ³n
MÃ©todo
Endpoint
DescripciÃ³n
Auth
POST
/auth/login
Login usuario
No
POST
/auth/register
Registrar usuario
Admin


7.2 Productos
MÃ©todo
Endpoint
DescripciÃ³n
Auth
GET
/products
Listar productos pÃºblicos
No
GET
/products/:slug
Obtener producto por slug
No
GET
/admin/products
Listar todos (admin)
JWT
GET
/admin/products/:id
Obtener por ID
JWT
POST
/admin/products
Crear producto
JWT
PATCH
/admin/products/:id
Actualizar producto
JWT
DELETE
/admin/products/:id
Eliminar (soft)
JWT
POST
/admin/products/:id/publish
Publicar
JWT


7.3 CategorÃ­as
MÃ©todo
Endpoint
DescripciÃ³n
Auth
GET
/categories
Listar categorÃ­as
No
GET
/categories/:slug
Obtener por slug
No
POST
/admin/categories
Crear categorÃ­a
JWT
PATCH
/admin/categories/:id
Actualizar
JWT
DELETE
/admin/categories/:id
Eliminar
JWT


7.4 Uploads (Cloudinary)
MÃ©todo
Endpoint
DescripciÃ³n
Auth
POST
/admin/uploads/image
Subir imagen
JWT
DELETE
/admin/uploads/:publicId
Eliminar imagen
JWT


7.5 Ejemplos de Request/Response

Ejemplo: POST /admin/products (Crear Producto)
POST /admin/products
Authorization: Bearer {jwt_token}
Content-Type: application/json

{
  "name": "Silla NÃ³rdica Minimalista",
  "slug": "silla-nordica-minimalista",
  "description": "Silla de diseÃ±o escandinavo con estructura de madera...",
  "price": 45000.00,
  "categoryId": "uuid-categoria",
  "specifications": {
    "material": "Madera de roble",
    "dimensiones": "80cm x 45cm x 50cm",
    "peso": "4.5kg",
    "color": "Natural"
  },
  "status": "DRAFT"
}

Response: 201 Created

{
  "id": "uuid-producto",
  "name": "Silla NÃ³rdica Minimalista",
  "slug": "silla-nordica-minimalista",
  "description": "Silla de diseÃ±o escandinavo con estructura de madera...",
  "price": "45000.00",
  "categoryId": "uuid-categoria",
  "category": {
    "id": "uuid-categoria",
    "name": "Mobiliario",
    "slug": "mobiliario"
  },
  "specifications": {
    "material": "Madera de roble",
    "dimensiones": "80cm x 45cm x 50cm",
    "peso": "4.5kg",
    "color": "Natural"
  },
  "status": "DRAFT",
  "images": [],
  "createdAt": "2026-01-29T12:00:00Z",
  "updatedAt": "2026-01-29T12:00:00Z"
}

8. FRONTEND ADMIN PANEL
8.1 TecnologÃ­as Admin Panel
â€¢ Astro Pages: Rutas y SSR
â€¢ React Components: Interactividad (formularios, tablas)
â€¢ React Hook Form: GestiÃ³n de formularios
â€¢ React Query (TanStack Query): Data fetching, cachÃ©, mutaciones
â€¢ Zod: ValidaciÃ³n de esquemas
â€¢ Ant Design o shadcn/ui: Componentes UI
â€¢ React Dropzone: Upload de imÃ¡genes
â€¢ Axios: Cliente HTTP

8.2 PÃ¡ginas del Admin Panel
Ruta
DescripciÃ³n
/admin/login
Login con email/password, retorna JWT
/admin
Dashboard: stats bÃ¡sicos (total productos, categorÃ­as)
/admin/productos
Lista de productos con filtros, bÃºsqueda, paginaciÃ³n
/admin/productos/nuevo
Formulario crear producto
/admin/productos/[id]/editar
Formulario editar producto
/admin/categorias
GestiÃ³n de categorÃ­as (CRUD simple)


8.3 Ejemplo: ProductForm.tsx (React Component)
// src/components/admin/ProductForm.tsx
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import { useMutation, useQueryClient } from '@tanstack/react-query';
import api from '@/lib/api';

const productSchema = z.object({
  name: z.string().min(3, 'MÃ­nimo 3 caracteres'),
  slug: z.string().min(3),
  description: z.string().optional(),
  price: z.number().positive('Precio debe ser positivo'),
  categoryId: z.string().uuid(),
  specifications: z.object({}).optional(),
  status: z.enum(['DRAFT', 'PUBLISHED'])
});

type ProductFormData = z.infer<typeof productSchema>;

export function ProductForm({ product, categories }: Props) {
  const queryClient = useQueryClient();
  const { register, handleSubmit, formState: { errors } } = useForm({
    resolver: zodResolver(productSchema),
    defaultValues: product
  });

  const mutation = useMutation({
    mutationFn: (data: ProductFormData) => {
      return product
        ? api.patch(`/admin/products/${product.id}`, data)
        : api.post('/admin/products', data);
    },
    onSuccess: () => {
      queryClient.invalidateQueries(['products']);
      // Redirect or show success
    }
  });

  return (
    <form onSubmit={handleSubmit(mutation.mutate)}>
      <input {...register('name')} placeholder="Nombre producto" />
      {errors.name && <span>{errors.name.message}</span>}
      
      {/* MÃ¡s campos... */}
      
      <button type="submit" disabled={mutation.isPending}>
        {mutation.isPending ? 'Guardando...' : 'Guardar'}
      </button>
    </form>
  );
}

9. FRONTEND PÃšBLICO (CATÃLOGO)
9.1 PÃ¡ginas PÃºblicas del CatÃ¡logo
â€¢ /productos: Grid de productos con filtros por categorÃ­a, bÃºsqueda
â€¢ /productos/[slug]: Detalle del producto con galerÃ­a de imÃ¡genes

9.2 CaracterÃ­sticas del CatÃ¡logo
âœ“ Grid responsive (mobile-first)
âœ“ Filtros por categorÃ­a (sidebar o dropdown)
âœ“ BÃºsqueda por nombre
âœ“ Lazy loading de imÃ¡genes
âœ“ Lightbox para galerÃ­a de producto
âœ“ SEO optimizado (meta tags dinÃ¡micos por producto)
âœ“ Schema.org markup para productos
âœ“ Breadcrumbs
âœ“ Share buttons (opcional)

9.3 Ejemplo: /productos/[slug].astro
---
// src/pages/productos/[slug].astro
import BaseLayout from '@/layouts/BaseLayout.astro';
import ProductGallery from '@/components/public/ProductGallery.astro';

const { slug } = Astro.params;

// Fetch product from API
const response = await fetch(`https://api.cliente.com/products/${slug}`);
if (!response.ok) {
  return Astro.redirect('/404');
}

const product = await response.json();

// SEO meta tags
const seo = {
  title: `${product.name} | GalerÃ­a`,
  description: product.description || `Descubre ${product.name}`,
  image: product.images[0]?.cloudinaryUrl || '/default-og.jpg'
};
---

<BaseLayout seo={seo}>
  <article class="product-detail">
    <div class="product-gallery">
      <ProductGallery images={product.images} />
    </div>
    
    <div class="product-info">
      <h1>{product.name}</h1>
      <p class="price">${product.price.toLocaleString()}</p>
      
      <div class="description">
        {product.description}
      </div>
      
      {product.specifications && (
        <div class="specs">
          <h3>Especificaciones</h3>
          <dl>
            {Object.entries(product.specifications).map(([key, value]) => (
              <>
                <dt>{key}</dt>
                <dd>{value}</dd>
              </>
            ))}
          </dl>
        </div>
      )}
      
      <a href="/contacto" class="btn-contact">Consultar</a>
    </div>
  </article>
</BaseLayout>

10. AUTENTICACIÃ“N Y SEGURIDAD
10.1 Flujo de AutenticaciÃ³n
1. Usuario ingresa email/password en /admin/login
2. Frontend envÃ­a POST /auth/login al backend
3. Backend valida credenciales con bcrypt
4. Si es vÃ¡lido, genera JWT con payload { userId, email, role }
5. Backend retorna { accessToken, user }
6. Frontend guarda token en cookie httpOnly (server-side)
7. Todas las requests a rutas /admin/* incluyen token en header
8. Backend valida JWT en cada request protegida

10.2 ConfiguraciÃ³n JWT
// Backend: src/auth/constants.ts
export const jwtConstants = {
  secret: process.env.JWT_SECRET, // Generar con: openssl rand -base64 32
  expiresIn: '7d' // Token expira en 7 dÃ­as
};

// Payload JWT:
{
  sub: 'user-uuid',       // User ID
  email: 'admin@cliente.com',
  role: 'ADMIN',
  iat: 1706543210,        // Issued at
  exp: 1707148010         // Expiration
}

10.3 Medidas de Seguridad
ğŸ”’ ContraseÃ±as hasheadas con bcrypt (salt rounds: 10)
ğŸ”’ JWT firmado con secret strong (32+ chars)
ğŸ”’ Tokens en httpOnly cookies (no localStorage)
ğŸ”’ CORS configurado solo para frontend domain
ğŸ”’ Rate limiting en endpoints sensibles
ğŸ”’ ValidaciÃ³n de inputs con class-validator (DTOs)
ğŸ”’ SQL injection protegido por Prisma ORM
ğŸ”’ HTTPS en producciÃ³n (certificado SSL)
ğŸ”’ Environment variables nunca en cÃ³digo
ğŸ”’ Helmet.js para security headers

11. INTEGRACIÃ“N CON CLOUDINARY
11.1 ConfiguraciÃ³n Cloudinary
// Backend: src/uploads/cloudinary.config.ts
import { v2 as cloudinary } from 'cloudinary';

cloudinary.config({
  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,
  api_key: process.env.CLOUDINARY_API_KEY,
  api_secret: process.env.CLOUDINARY_API_SECRET,
});

export default cloudinary;

// .env
CLOUDINARY_CLOUD_NAME=cliente-galeria
CLOUDINARY_API_KEY=your-api-key
CLOUDINARY_API_SECRET=your-api-secret

11.2 Flujo de Upload
1. Usuario selecciona imÃ¡genes en admin panel (drag & drop o file input)
2. Frontend envÃ­a POST /admin/uploads/image con multipart/form-data
3. Backend recibe archivo, valida tipo (jpg, png, webp)
4. Backend sube a Cloudinary con transformaciones
5. Cloudinary retorna URL y public_id
6. Backend guarda en ProductImage tabla
7. Frontend actualiza UI con imagen subida

11.3 Transformaciones AutomÃ¡ticas
// Subir con transformaciones
const result = await cloudinary.uploader.upload(file.path, {
  folder: 'productos',
  transformation: [
    { width: 1200, height: 1200, crop: 'limit' },
    { quality: 'auto:good' },
    { fetch_format: 'auto' } // WebP cuando el browser lo soporte
  ]
});

// Generar variantes en frontend:
// Thumbnail: .../upload/w_300,h_300,c_fill/...
// Medium: .../upload/w_800,h_800,c_limit/...
// Full: .../upload/w_1200,h_1200,c_limit/...

11.4 LÃ­mites Free Tier
â€¢ Storage: 25GB
â€¢ Bandwidth: 25GB/mes
â€¢ Transformaciones: 25 crÃ©ditos/mes
â€¢ MÃ¡s que suficiente para catÃ¡logo de 100-200 productos

12. DEPLOY Y DEVOPS
12.1 Deploy Frontend (Vercel/Netlify)
â€¢ Conectar repo GitHub a Vercel
â€¢ Configurar variables de entorno (VITE_API_URL)
â€¢ Build command: npm run build
â€¢ Output directory: dist
â€¢ Deploy automÃ¡tico en push a main
â€¢ Preview deployments en PRs

// vercel.json (opcional)
{
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "framework": "astro",
  "env": {
    "VITE_API_URL": "@api-url"
  }
}

12.2 Deploy Backend (VPS AndesCode)
â€¢ Conectar al VPS via SSH
â€¢ Instalar Node.js 20 LTS
â€¢ Clonar repo backend
â€¢ Instalar dependencias: npm install --production
â€¢ Configurar .env con variables de producciÃ³n
â€¢ Ejecutar migraciones: npx prisma migrate deploy
â€¢ Generar Prisma Client: npx prisma generate
â€¢ Build: npm run build
â€¢ Configurar PM2 para proceso persistente
â€¢ Configurar nginx como reverse proxy
â€¢ Configurar SSL con certbot (Let's Encrypt)

// ecosystem.config.js
module.exports = {
  apps: [{
    name: 'galeria-api',
    script: 'dist/main.js',
    instances: 1,
    exec_mode: 'cluster',
    env: {
      NODE_ENV: 'production',
      PORT: 3000
    },
    error_file: 'logs/err.log',
    out_file: 'logs/out.log',
    log_file: 'logs/combined.log',
    time: true
  }]
};

// Comandos PM2:
// pm2 start ecosystem.config.js
// pm2 save
// pm2 startup

# /etc/nginx/sites-available/galeria-api
server {
    listen 80;
    server_name api.cliente.com;
    
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# SSL con certbot:
# sudo certbot --nginx -d api.cliente.com

12.3 ConfiguraciÃ³n Supabase
â€¢ Crear proyecto en supabase.com
â€¢ Copiar Database URL (PostgreSQL connection string)
â€¢ Agregar a .env: DATABASE_URL="postgresql://..."
â€¢ Ejecutar migraciones con Prisma
â€¢ Configurar Row Level Security si es necesario
â€¢ Habilitar Connection Pooling para mejor performance

12.4 CI/CD (Opcional para Fase 2)
Para automatizar deploys backend, considerar GitHub Actions:
# .github/workflows/deploy.yml
name: Deploy Backend

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '20'
      - run: npm ci
      - run: npm run build
      - name: Deploy to VPS
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.VPS_HOST }}
          username: ${{ secrets.VPS_USER }}
          key: ${{ secrets.SSH_KEY }}
          script: |
            cd /var/www/galeria-api
            git pull
            npm install --production
            npx prisma migrate deploy
            pm2 restart galeria-api

13. TESTING Y QA
13.1 Estrategia de Testing
â€¢ Unit tests: Servicios y utilidades (Jest)
â€¢ Integration tests: Endpoints API (Supertest)
â€¢ E2E tests: Flujos crÃ­ticos admin panel (Playwright)
â€¢ Manual testing: UI/UX, responsive, cross-browser

13.2 Casos de Prueba Principales
Ãrea
Caso de Prueba
Resultado Esperado
Auth
Login con credenciales vÃ¡lidas
RedirecciÃ³n a dashboard + JWT
Auth
Login con credenciales invÃ¡lidas
Error 401
Products
Crear producto completo
Producto guardado en DB
Products
Subir imÃ¡genes a producto
ImÃ¡genes en Cloudinary + DB
Products
Publicar producto draft
Status cambia a PUBLISHED
Products
Eliminar producto
Soft delete (deletedAt != null)
Categories
Crear categorÃ­a
CategorÃ­a guardada
Frontend
CatÃ¡logo muestra solo publicados
Solo status PUBLISHED visibles
Frontend
Detalle producto load imÃ¡genes
GalerÃ­a funcional
Responsive
Admin en mobile
UI usable en 375px width


13.3 Ejemplo: Unit Test
// products.service.spec.ts
import { Test, TestingModule } from '@nestjs/testing';
import { ProductsService } from './products.service';
import { PrismaService } from '../prisma/prisma.service';

describe('ProductsService', () => {
  let service: ProductsService;
  let prisma: PrismaService;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [ProductsService, PrismaService],
    }).compile();

    service = module.get<ProductsService>(ProductsService);
    prisma = module.get<PrismaService>(PrismaService);
  });

  it('should create a product', async () => {
    const mockProduct = {
      name: 'Test Product',
      slug: 'test-product',
      price: 100,
      categoryId: 'uuid',
      status: 'DRAFT'
    };

    jest.spyOn(prisma.product, 'create').mockResolvedValue({
      id: 'uuid',
      ...mockProduct,
      createdAt: new Date(),
      updatedAt: new Date()
    });

    const result = await service.create(mockProduct);
    expect(result.name).toBe('Test Product');
  });
});

14. CRONOGRAMA DETALLADO
Timeline: 4 semanas (20 dÃ­as hÃ¡biles)

Semana 1: Backend Foundation (5 dÃ­as)
DÃ­a 1-2: Setup proyecto NestJS
  â€¢ Crear proyecto con Nest CLI
  â€¢ Configurar Prisma + Supabase
  â€¢ Definir schema.prisma
  â€¢ Primera migraciÃ³n
  â€¢ Setup env variables

DÃ­a 3: MÃ³dulo de Auth
  â€¢ AuthModule con Passport + JWT
  â€¢ Login endpoint
  â€¢ JWT strategy y guards
  â€¢ Bcrypt para passwords

DÃ­a 4-5: MÃ³dulos Products y Categories
  â€¢ CRUD endpoints completos
  â€¢ DTOs y validaciones
  â€¢ Servicios con Prisma
  â€¢ Soft delete en productos

Semana 2: Backend Upload + Admin Panel Start (5 dÃ­as)
DÃ­a 1: IntegraciÃ³n Cloudinary
  â€¢ Upload module
  â€¢ Upload endpoint con multer
  â€¢ Transformaciones automÃ¡ticas
  â€¢ Delete endpoint

DÃ­a 2: Testing Backend
  â€¢ Unit tests de servicios
  â€¢ Integration tests de endpoints
  â€¢ Postman collection para testing manual

DÃ­a 3-4: Setup Admin Panel
  â€¢ Agregar rutas /admin/* al proyecto Astro
  â€¢ Configurar React en Astro
  â€¢ Crear AdminLayout
  â€¢ PÃ¡gina de login
  â€¢ Cliente API (axios)

DÃ­a 5: Dashboard bÃ¡sico
  â€¢ Stats de productos y categorÃ­as
  â€¢ NavegaciÃ³n del panel

Semana 3: Admin Panel Completo + Frontend Integration (5 dÃ­as)
DÃ­a 1-2: GestiÃ³n de Productos
  â€¢ Lista de productos (tabla con filtros)
  â€¢ ProductForm component (React Hook Form)
  â€¢ Validaciones con Zod
  â€¢ Create/Edit flows

DÃ­a 3: Upload de ImÃ¡genes
  â€¢ ImageUploader component (react-dropzone)
  â€¢ Preview de imÃ¡genes
  â€¢ Delete imÃ¡genes
  â€¢ Reordenar imÃ¡genes

DÃ­a 4: GestiÃ³n de CategorÃ­as
  â€¢ CRUD simple de categorÃ­as
  â€¢ Modal o pÃ¡gina dedicada

DÃ­a 5: IntegraciÃ³n Frontend PÃºblico
  â€¢ Actualizar /productos/index.astro
  â€¢ Fetch desde API
  â€¢ Grid responsive

Semana 4: Frontend CatÃ¡logo + Testing + Deploy (5 dÃ­as)
DÃ­a 1: Detalle de Producto
  â€¢ PÃ¡gina /productos/[slug].astro
  â€¢ GalerÃ­a de imÃ¡genes
  â€¢ SEO optimizado
  â€¢ Schema.org markup

DÃ­a 2: Filtros y BÃºsqueda
  â€¢ Filtro por categorÃ­a
  â€¢ BÃºsqueda por nombre
  â€¢ URL params para compartir filtros

DÃ­a 3: Testing Integral
  â€¢ QA de todos los flujos
  â€¢ Testing responsive (mobile/tablet/desktop)
  â€¢ Cross-browser testing
  â€¢ OptimizaciÃ³n de imÃ¡genes
  â€¢ Performance testing

DÃ­a 4: Deploy
  â€¢ Deploy backend a VPS
  â€¢ Configurar nginx + SSL
  â€¢ Deploy frontend a Vercel
  â€¢ Configurar dominios
  â€¢ Seed inicial de datos

DÃ­a 5: CapacitaciÃ³n y Entrega
  â€¢ SesiÃ³n de capacitaciÃ³n con cliente
  â€¢ DocumentaciÃ³n de uso
  â€¢ RevisiÃ³n final
  â€¢ Entrega oficial

15. CONSIDERACIONES PARA E-COMMERCE FUTURO
15.1 Arquitectura Preparada para Escalar
Esta implementaciÃ³n estÃ¡ diseÃ±ada pensando en que el cliente eventualmente querrÃ¡ vender online. La arquitectura actual facilita agregar:
+ Carrito de compras (tabla Cart + CartItem)
+ Ã“rdenes de compra (tabla Order + OrderItem)
+ GestiÃ³n de inventario (stock en Product)
+ Pasarelas de pago (MercadoPago, Stripe)
+ GestiÃ³n de envÃ­os (integraciÃ³n con correo)
+ Estados de orden (pending, paid, shipped, delivered)
+ Panel de seguimiento para clientes
+ Notificaciones por email
+ FacturaciÃ³n automÃ¡tica

15.2 Extensiones del Schema para E-commerce
// Agregar a prisma/schema.prisma en fase e-commerce:

model Product {
  // ... campos existentes
  stock         Int            @default(0)
  sku           String?        @unique
  weight        Decimal?       // Para cÃ¡lculo de envÃ­o
  cartItems     CartItem[]
  orderItems    OrderItem[]
}

model Cart {
  id        String     @id @default(uuid())
  userId    String?    @map("user_id")
  sessionId String?    @map("session_id")
  items     CartItem[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}

model CartItem {
  id        String  @id @default(uuid())
  cartId    String  @map("cart_id")
  cart      Cart    @relation(fields: [cartId], references: [id])
  productId String  @map("product_id")
  product   Product @relation(fields: [productId], references: [id])
  quantity  Int
  price     Decimal @db.Decimal(10, 2) // Snapshot del precio
}

model Order {
  id              String      @id @default(uuid())
  orderNumber     String      @unique
  userId          String?     @map("user_id")
  customerEmail   String
  customerName    String
  status          OrderStatus @default(PENDING)
  subtotal        Decimal     @db.Decimal(10, 2)
  shipping        Decimal     @db.Decimal(10, 2)
  total           Decimal     @db.Decimal(10, 2)
  shippingAddress Json
  paymentMethod   String
  paymentId       String?
  items           OrderItem[]
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
}

enum OrderStatus {
  PENDING
  PAID
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

model OrderItem {
  id        String  @id @default(uuid())
  orderId   String  @map("order_id")
  order     Order   @relation(fields: [orderId], references: [id])
  productId String  @map("product_id")
  product   Product @relation(fields: [productId], references: [id])
  quantity  Int
  price     Decimal @db.Decimal(10, 2)
  name      String  // Snapshot
}

15.3 EstimaciÃ³n Fase E-commerce
Trabajo adicional estimado para convertir catÃ¡logo en tienda online:
Backend: 2 semanas adicionales
  â€¢ MÃ³dulos Cart, Orders, Payments
  â€¢ IntegraciÃ³n MercadoPago/Stripe
  â€¢ Email notifications
  â€¢ Admin: gestiÃ³n de Ã³rdenes

Frontend: 2 semanas adicionales
  â€¢ Carrito de compras
  â€¢ Checkout flow
  â€¢ ConfirmaciÃ³n de orden
  â€¢ Panel de seguimiento usuario

Total: 3-4 semanas
Presupuesto estimado: $400-600 USD adicionales





NOTAS FINALES
â€¢ Este documento es confidencial y para uso interno del equipo de desarrollo AndesCode.
â€¢ Mantener actualizado con cambios durante el desarrollo.
â€¢ Usar este documento como referencia para ClaudeCode y nuevos miembros del equipo.
â€¢ Para consultas tÃ©cnicas: andescodesj@gmail.com

VersiÃ³n: 1.0 | Fecha: Enero 2026 | AndesCode
