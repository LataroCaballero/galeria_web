---
export const prerender = false;

import AdminLayout from '../../../../layouts/AdminLayout.astro';
import ProductForm from '../../../../components/admin/ProductForm';
import { getTokenFromCookies } from '../../../../lib/auth';

const { id } = Astro.params;
const token = getTokenFromCookies(Astro.request.headers.get('cookie'));
const API = import.meta.env.PUBLIC_API_URL;

let product = null;

try {
  const res = await fetch(`${API}/admin/products/${id}`, {
    headers: { Authorization: `Bearer ${token}` },
  });
  if (res.ok) {
    const data = await res.json();
    product = data.data || data;
  }
} catch (e) {
  // Product not found
}

if (!product) {
  return Astro.redirect('/admin/productos');
}
---

<AdminLayout title={`Editar: ${product.name}`}>
  <ProductForm client:load product={product} apiUrl={API} />
</AdminLayout>
